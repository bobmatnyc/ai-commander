---
actual_hours: null
assignees: []
created_at: '2026-02-02T08:31:25.343860'
dependencies: []
description: '## Summary


  TUI and Telegram bot have significant duplicated business logic that should be extracted
  to a shared crate.


  ## Duplicated Code to Extract


  | Logic | TUI Location | Telegram Location |

  |-------|-------------|-------------------|

  | Connect to project | `app.rs:247-304` | `state.rs:220-295` |

  | Parse connect args | `app.rs:307-356` | `handlers.rs:204-253` |

  | UI noise filtering | `app.rs:1380-1448` | `state.rs:666-724` |

  | Claude ready detection | `app.rs:1316-1377` | `state.rs:611-663` |

  | Find new lines | `app.rs:1296-1313` | `state.rs:591-608` |

  | Clean raw response | `app.rs:1519-1538` | `state.rs:727-745` |

  | Summarize response | `app.rs:1451-1516` | `state.rs:393-447` |


  ## Proposed Structure


  ```

  crates/commander-core/

  ├── Cargo.toml

  ├── src/

  │   ├── lib.rs

  │   ├── project_manager.rs   # connect/disconnect/list logic

  │   ├── output_filter.rs     # UI noise filtering, is_claude_ready

  │   ├── summarizer.rs        # response summarization

  │   └── config.rs            # shared configuration (state_dir, etc.)

  ```


  ## Benefits


  - Single source of truth for business logic

  - Ensures TUI and Telegram stay in sync

  - Easier to add new interfaces (GUI, web, etc.)

  - Better testability


  ## Acceptance Criteria


  - [ ] Create commander-core crate with proposed module structure

  - [ ] Extract connect/disconnect/list logic to project_manager.rs

  - [ ] Extract UI noise filtering and Claude ready detection to output_filter.rs

  - [ ] Extract response summarization to summarizer.rs

  - [ ] Extract shared configuration to config.rs

  - [ ] Update TUI (commander-cli) to use commander-core

  - [ ] Update Telegram bot (commander-telegram) to use commander-core

  - [ ] All existing tests pass

  - [ ] Add unit tests for extracted modules'
due_date: null
estimated_hours: null
id: ISS-0013
labels: []
metadata:
  issue_type: enhancement
  severity: high
  type: issue
parent: null
priority: high
status: open
tags:
- issue
- enhancement
- refactoring
- architecture
- tech-debt
- rust
title: Extract shared business logic to commander-core crate
updated_at: '2026-02-02T08:31:25.343860'
---

# Extract shared business logic to commander-core crate

## Description
## Summary

TUI and Telegram bot have significant duplicated business logic that should be extracted to a shared crate.

## Duplicated Code to Extract

| Logic | TUI Location | Telegram Location |
|-------|-------------|-------------------|
| Connect to project | `app.rs:247-304` | `state.rs:220-295` |
| Parse connect args | `app.rs:307-356` | `handlers.rs:204-253` |
| UI noise filtering | `app.rs:1380-1448` | `state.rs:666-724` |
| Claude ready detection | `app.rs:1316-1377` | `state.rs:611-663` |
| Find new lines | `app.rs:1296-1313` | `state.rs:591-608` |
| Clean raw response | `app.rs:1519-1538` | `state.rs:727-745` |
| Summarize response | `app.rs:1451-1516` | `state.rs:393-447` |

## Proposed Structure

```
crates/commander-core/
├── Cargo.toml
├── src/
│   ├── lib.rs
│   ├── project_manager.rs   # connect/disconnect/list logic
│   ├── output_filter.rs     # UI noise filtering, is_claude_ready
│   ├── summarizer.rs        # response summarization
│   └── config.rs            # shared configuration (state_dir, etc.)
```

## Benefits

- Single source of truth for business logic
- Ensures TUI and Telegram stay in sync
- Easier to add new interfaces (GUI, web, etc.)
- Better testability

## Acceptance Criteria

- [ ] Create commander-core crate with proposed module structure
- [ ] Extract connect/disconnect/list logic to project_manager.rs
- [ ] Extract UI noise filtering and Claude ready detection to output_filter.rs
- [ ] Extract response summarization to summarizer.rs
- [ ] Extract shared configuration to config.rs
- [ ] Update TUI (commander-cli) to use commander-core
- [ ] Update Telegram bot (commander-telegram) to use commander-core
- [ ] All existing tests pass
- [ ] Add unit tests for extracted modules

## Details
- **Status**: open
- **Priority**: high
- **Assignees**: None
- **Tags**: issue, enhancement, refactoring, architecture, tech-debt, rust
- **Created**: 2026-02-02 08:31:25
- **Updated**: 2026-02-02 08:31:25

## Tasks
- [ ] Add task items here

## Notes
_Add any additional notes or context here._
